# ICE — Health Insurance API (v0)

Full health insurance buying journey — from quote generation to policy purchase and payment.

---

## Base URL

```
UAT:        https://api-uat.ensuredit.com
Production: https://api.ensuredit.com
```

---

## Flow Overview

The health insurance journey follows these steps:

```
1. Authenticate  →  2. Get Quote Fields  →  3. Create Quote
       ↓
4. Get Proposal Fields  →  5. Create Proposal  →  6. Payment
```

---

## 1. Authentication

<span class="method-post">POST</span> `{{domain}}/login/verifyPassword`

```json
{
  "userId": "your_user_id",
  "password": "your_password"
}
```

**Response** `200 OK`:
```json
{
  "isVerified": true,
  "accessToken": "your_access_token",
  "refreshToken": "your_refresh_token",
  "accessList": [...]
}
```

---

## 2. Get Quote Fields

<span class="method-get">GET</span> `{{domain}}/preQuote/quoteFields`

Retrieve the dynamic form fields required to generate a health insurance quote.

**Query Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `product` | string | Yes | Insurance product type (e.g., `HEALTH`) |
| `leadId` | string | Yes | Unique lead identifier |

**Response** `200 OK`:

Returns a `pages` array with dynamic form fields including field types (`text`, `date`, `autoCompleteText`, `editText`, `checkboxGroup`), validation rules, and layout configuration.

Each field contains:
- `fieldId` — unique identifier
- `viewType` — UI component type
- `validation` — rules including regex, min/max length
- `alignment` — layout hints (col, row, direction)

---

## 3. Create Quote

<span class="method-post">POST</span> `{{domain}}/getQuote/HEALTH`

Submit customer details to generate insurance quotes from multiple carriers.

**Headers:**
```
Authorization: Bearer <access_token>
Content-Type: application/json
```

**Request Body:**
```json
{
  "fieldData": [
    {
      "id": "gender",
      "value": "male",
      "parentProperty": "proposerDetails"
    },
    {
      "id": "pincode",
      "value": "400001",
      "parentProperty": "communicationAddress"
    }
  ],
  "salesChannelUserId": "2"
}
```

**Response** `200 OK`:
```json
{
  "id": 31643,
  "product": "HEALTH",
  "status": "SUCCESS",
  "quotePlans": [
    {
      "companyId": 31,
      "planId": 111,
      "payingAmount": 8066,
      "planData": {
        "paymentModes": [
          { "internalName": "FORM", "displayName": "Payment Gateway" }
        ],
        "brochure": "https://..."
      }
    }
  ]
}
```

---

## 4. Get Proposal Fields

<span class="method-get">GET</span> `{{domain}}/preProposal/proposalFields`

Retrieve the form fields required for the proposal step.

**Query Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `companyId` | integer | Yes | Insurance company ID from quote |
| `product` | string | Yes | Product type (e.g., `HEALTH`) |
| `step` | integer | Yes | Step number in proposal process |
| `sumInsured` | integer | Yes | Coverage amount |
| `quoteId` | integer | Yes | Quote ID from step 3 |
| `quotePlanId` | integer | Yes | Selected plan ID from step 3 |

**Response** `200 OK`:

Returns form pages with fields, navigation controls, and header info (company logo, premium amount, policy type).

---

## 5. Create Proposal

<span class="method-post">POST</span> `{{domain}}/proposal/HEALTH/create`

Submit the completed proposal form.

**Request Body:**
```json
{
  "fields": [
    { "id": "proposerTitle", "parentProperty": "proposerDetails", "value": "Mr." },
    { "id": "proposerFullName", "parentProperty": "proposerDetails", "value": "John Doe" },
    { "id": "proposerGender", "parentProperty": "proposerDetails", "value": "Male" },
    { "id": "proposerDOB", "parentProperty": "proposerDetails", "value": "15/01/1990" },
    { "id": "proposerEmail", "parentProperty": "proposerDetails", "value": "john@example.com" },
    { "id": "proposerPhone", "parentProperty": "proposerDetails", "value": "9876543210" }
  ],
  "quotePlanId": "245916",
  "leadId": "29297",
  "salesChannelUserId": "305"
}
```

**Response** `200 OK`:
```json
{
  "id": 27164,
  "product": "HEALTH",
  "status": "SUCCESS",
  "paymentData": {
    "modes": [
      { "displayName": "Payment Gateway", "internalName": "FORM" }
    ]
  },
  "proposalId": 27164
}
```

---

## 6. Get Payment Form

<span class="method-get">GET</span> `{{domain}}/proposal/HEALTH/paymentForm/{leadId}`

Retrieve the payment gateway redirect form.

**Response** `200 OK`:

Returns an HTML form that auto-submits to the payment gateway. The callback URL handles payment confirmation and policy issuance.

---

## Proposal Statuses

| Status | Description |
|--------|-------------|
| `SUCCESS` | Proposal accepted, ready for payment |
| `FAILED` | Proposal rejected — check `insurerSpecificData` for details |
| `PENDING_CKYC` | Awaiting KYC verification |
| `PAYMENT_PENDING` | Awaiting payment |
| `POLICY_ISSUED` | Payment successful, policy issued |
